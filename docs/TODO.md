# 論文陪讀APP開發計畫 - TODO List

> **項目目標：** 開發一個智能論文陪讀APP，結合RAG技術為用戶提供論文閱讀和AI問答服務

## 📋 開發階段規劃

### 🏗️ 階段一：數據處理與存儲 (優先級：HIGH)

#### 1. 論文解析與格式處理
- [x] **完善PDF解析服務** ✅ **已完成 (2025-08-31)**
  - [x] 驗證MinerU輸出的Markdown和JSON格式品質 ✅
  - [x] 處理數學公式的LaTeX格式轉換 ✅
  - [x] 優化表格和圖片的識別與處理 ✅ (成功提取23張圖片)
  - [x] 實現批次PDF處理功能架構 ✅

- [x] **數據預處理管道** ✅ **已完成 (2025-08-31)**
  - [x] 設計JSON格式的內容分段策略 ✅
  - [x] 實現按段落、頁面、內容類型的智能分段 ✅
  - [x] 清理和標準化文本內容 ✅
  - [x] 處理特殊字符和編碼問題 ✅
  - [x] 智能檔名處理 (解決Windows長路徑限制) ✅

- [x] **多語言翻譯處理** ✅ **已完成 (2025-09-02)**
  - [x] ✅ 選擇翻譯服務 (Ollama本地模型 + Google Gemini API)
  - [x] ✅ 設計學術論文專用翻譯策略 (TranslateHelper自定義模型)
  - [x] ✅ 實現分段翻譯和術語一致性保持 (術語字典系統)
  - [x] ✅ 處理數學公式、圖表標題、參考文獻的翻譯 (內容類型分類)
  - [x] ✅ 建立翻譯品質評估和人工校對機制 (重試機制)
  - [x] ✅ 實現雙語版本同步和映射關係 (progress系統)
  - [x] ✅ 實現翻譯進度保存和恢復功能
  - [x] ✅ 設計統一翻譯器接口 (TranslatorBase抽象類)
  - [x] ✅ GPU保護機制 (批次處理 + 休息間隔)

#### 2. RAG資料庫建置 ✅ **已完成 (2025-09-05)**
- [x] **向量數據庫選擇與配置** ✅ **已完成**
  - [x] 評估向量資料庫選項 - 選用ChromaDB ✅
  - [x] 配置embedding模型 (nomic-embed-v2-text-moe) ✅ 
  - [x] 設計文檔分片策略和metadata結構 (基於content_list.json) ✅
  - [x] 實現相似度搜索和向量檢索 ✅
  - [x] 設計雙語版本的向量化策略 (基於text_zh翻譯內容) ✅
  - [x] 實現智能切片和批次處理 (10個文檔測試成功) ✅

- [x] **知識庫管理系統** ✅ **已完成**
  - [x] 實現文檔索引建立 (自動向量化) ✅
  - [x] 設計增量更新機制 (集合重建策略) ✅
  - [x] 添加文檔去重和版本控制 (唯一切片ID) ✅
  - [x] 創建RAG引擎管理介面 (完整API) ✅

#### 2.1 **RAG問答系統** ✅ **已完成 (2025-09-05)**
- [x] **核心RAG引擎** ✅ **已完成**
  - [x] 實現語義檢索引擎 (ChromaDB + embedding) ✅
  - [x] 集成LLM服務 (Ollama + Gemini雙後端) ✅
  - [x] 實現上下文組合和答案生成 ✅
  - [x] 支援流式問答回應 ✅
  - [x] 實現來源追蹤和引用系統 ✅

### 🏗️ 階段二：統一API介面整合 ✅ **新增已完成 (2025-09-06)**

#### 3. **PDFHelper 統一API設計** ✅ **已完成**
- [x] **統一返回格式** ✅ **已完成**
  - [x] 設計 HelperResult 統一回應格式 ✅
  - [x] 實現統一錯誤處理機制 ✅
  - [x] 統一所有API函式返回格式 ✅

- [x] **核心工作流程API** ✅ **已完成**
  - [x] process_pdf_to_json() - PDF解析接口 ✅
  - [x] translate_json_content() - 翻譯服務接口 ✅
  - [x] add_json_to_rag() - 向量化存儲接口 ✅
  - [x] from_pdf_to_rag() - 完整工作流程整合 ✅
  - [x] ask_question() - RAG問答接口 ✅
  - [x] reconstruct_markdown() - Markdown重組接口 ✅

- [x] **系統管理API** ✅ **已完成**
  - [x] get_system_health() - 系統健康檢查 ✅
  - [x] 統一配置管理 (Config類) ✅
  - [x] 詳細日誌和進度追蹤 ✅

- [x] **API測試驗證** ✅ **已完成 (2025-09-07)**
  - [x] 完整工作流程測試 (PDF→翻譯→RAG→問答) ✅
  - [x] 系統效能測試 (PDF處理30s, 翻譯24s, 向量化6s, 問答0.2s) ✅
  - [x] 錯誤處理和恢復機制測試 ✅
  - [x] 流式輸出功能驗證 ✅
  - [x] 實現語義檢索和相似度排序 ✅
  - [x] 設計上下文窗口管理策略 (智能文檔片段組合) ✅
  - [x] 優化提示詞工程和回答生成 ✅
  - [x] 添加回答品質評估機制 (響應時間監控) ✅

- [x] **LLM集成** ✅ **已完成**
  - [x] 支援多種語言模型 (Gemini API + Ollama本地) ✅
  - [x] 實現模型切換和參數調整 (智能可用性檢查) ✅
  - [x] 優化token使用和成本控制 (本地備用方案) ✅
  - [x] 添加服務狀態檢查和錯誤處理 ✅

### 🎨 階段二：用戶界面開發 (優先級：HIGH) ✅ **核心功能已完成 (2025-10-13)**

#### 3. Electron 桌面應用架構 ✅ **已完成**
- [x] **應用框架搭建** ✅ **已完成**
  - [x] Electron 主程序配置 (main.js) ✅
  - [x] 自訂標題列與視窗控制 ✅
  - [x] IPC 通訊機制建立 ✅
  - [x] TypeScript 模組編譯系統 (API Client, Server Manager) ✅

- [x] **後端服務整合** ✅ **已完成**
  - [x] Flask 伺服器自動啟動與管理 ✅
  - [x] HTTP API Client 封裝 ✅
  - [x] 進度追蹤與即時更新機制 ✅
  - [x] 錯誤處理與自動恢復 ✅

#### 4. 論文閱讀界面 ✅ **已完成**
- [x] **基礎閱讀功能** ✅ **已完成**
  - [x] Markdown 渲染器集成 (Marked.js) ✅
  - [x] 支援數學公式顯示 (KaTeX) ✅
  - [x] 實現頁面導航和目錄結構 ✅
  - [x] 添加全文搜索和高亮功能 ✅

- [x] **互動功能** ✅ **已完成**
  - [x] 實現文字選擇和標註功能 ✅
  - [x] 添加書籤和筆記系統 ✅
  - [x] 設計跳轉和引用追蹤 ✅
  - [x] 支援分割檢視 (雙欄對照) ✅

#### 5. AI 問答界面 ✅ **已完成**
- [x] **問答系統前端** ✅ **已完成**
  - [x] 設計對話界面和聊天記錄 ✅
  - [x] 實現問題輸入和回答顯示 ✅
  - [x] 添加來源引用和位置標註 ✅
  - [x] 支援問答歷史管理 ✅

- [x] **HTTP API 整合** ✅ **已完成 (2025-10-13)**
  - [x] 替換 Python 腳本為 HTTP API 調用 ✅
  - [x] 實現 `apiClient.askQuestion()` 整合 ✅
  - [x] 自動 collection_name 管理 ✅
  - [x] 全局文件狀態追蹤 (currentDocumentState) ✅

- [x] **設定管理系統** ✅ **已完成 (2025-10-12)**
  - [x] 三服務分開設定 (Translator/Embedding/RAG) ✅
  - [x] API Key 即時驗證與模型列表載入 ✅
  - [x] 模型類型過濾 (語言模型 vs Embedding 模型) ✅
  - [x] 主題切換與持久化儲存 ✅

#### 6. PDF 處理流程 ✅ **已完成**
- [x] **完整處理流程** ✅ **已完成**
  - [x] 檔案上傳與拖放支援 ✅
  - [x] PDF → JSON → 翻譯 → RAG 全流程整合 ✅
  - [x] Markdown 自動重組與渲染 ✅
  - [x] 即時進度追蹤與日誌顯示 ✅
  - [x] 歷史記錄管理 (history.json) ✅

- [x] **進階功能** ✅ **已完成**
  - [x] 多檔案批次處理支援 ✅
  - [x] 處理失敗自動恢復機制 ✅
  - [x] 檔案刪除（前端 + 後端同步） ✅
  - [x] 卡住任務自動重置 (429 錯誤處理) ✅

### 🤖 階段三：AI服務開發 (優先級：MEDIUM) ✅ **核心功能已完成**

#### 5. RAG問答系統 ✅ **已完成 (2025-09-05)**
- [x] **核心RAG引擎** ✅ **已完成**
  - [x] 實現語義檢索和重排序 ✅
  - [x] 設計上下文窗口管理策略 ✅
  - [x] 優化提示詞工程和回答生成 ✅
  - [x] 添加回答品質評估機制 ✅

- [x] **LLM集成** ✅ **已完成**
  - [x] 支援多種語言模型 (Gemini API, Ollama本地模型) ✅
  - [x] 實現模型切換和參數調整 ✅
  - [x] 優化token使用和成本控制 ✅
  - [x] 添加回答一致性檢查 ✅

- [x] **流式輸出和用戶體驗** ✅ **已完成 (2025-09-07)**
  - [x] 實現流式問答回應 (支援Gemini和Ollama) ✅
  - [x] 統一流式輸出格式 ✅
  - [x] 優化回應速度 (問答0.2秒內響應) ✅

#### 6. 智能功能擴展
- [ ] **論文分析工具**
  - [ ] 自動生成論文摘要
  - [ ] 提取關鍵詞和主題標籤
  - [ ] 分析論文結構和邏輯關係
  - [ ] 識別創新點和貢獻

- [ ] **個性化推薦**
  - [ ] 基於閱讀習慣的內容推薦
  - [ ] 相關論文發現和推薦
  - [ ] 個人知識圖譜建構
  - [ ] 學習進度追蹤

### 🔧 階段四：系統優化 (優先級：MEDIUM)

#### 7. 性能優化
- [ ] **前端優化**
  - [ ] 實現虛擬滾動和懶載入
  - [ ] 優化渲染性能和記憶體使用
  - [ ] 添加離線緩存和PWA支持
  - [ ] 實現響應式設計和移動端適配

- [ ] **後端優化**
  - [ ] 優化資料庫查詢和索引
  - [ ] 實現緩存策略和CDN配置
  - [ ] 添加API限流和負載均衡
  - [ ] 監控系統性能和錯誤追蹤

#### 8. 用戶體驗優化
- [ ] **易用性改進**
  - [ ] 設計直觀的用戶引導
  - [ ] 添加快捷鍵和手勢操作
  - [ ] 實現主題切換和個人化設置
  - [ ] 優化載入速度和互動反饋

### 🚀 階段五：部署與維護 (優先級：LOW)

#### 9. 部署配置
- [ ] **生產環境準備**
  - [ ] 設定Docker容器化部署
  - [ ] 配置CI/CD管道
  - [ ] 準備雲端服務配置 (AWS/GCP/Azure)
  - [ ] 實現自動化測試和部署

#### 10. 維護與擴展
- [ ] **系統監控**
  - [ ] 設置日誌收集和分析
  - [ ] 實現健康檢查和告警機制
  - [ ] 添加用戶行為追蹤和分析
  - [ ] 定期安全漏洞掃描

## 📊 **開發進度總結 (更新至 2025-10-13)**

### ✅ **已完成的核心系統**
1. **PDF 處理引擎** (100%) - MinerU 完整整合
2. **翻譯系統** (100%) - 雙語支援完整實現
3. **RAG 向量檢索** (100%) - ChromaDB + Embedding 完整
4. **問答系統** (100%) - 流式問答完整實現
5. **統一 API 介面** (100%) - PDFHelper 完整整合
6. **Electron 桌面應用** (100%) - 完整前端界面與 HTTP API 整合

### 📈 **系統效能指標**
- **PDF 處理**: 30.49秒 (中等論文)
- **翻譯速度**: 24.40秒 (10個段落)
- **向量化存儲**: 5.99秒 (10個片段)
- **問答回應**: 0.19秒 (語義檢索+生成)
- **整體工作流程**: 60秒內完成 (PDF→翻譯→RAG→可問答)
- **Markdown 渲染**: 即時顯示（含 LaTeX 支援）
- **前端響應**: <100ms（Electron 本地應用）

### 🎯 **技術特色**
- ✅ **雙後端支援**: Ollama 本地 + Gemini 雲端
- ✅ **流式輸出**: 即時回應用戶體驗
- ✅ **統一 API**: HelperResult 統一返回格式
- ✅ **完整工作流程**: 一鍵從 PDF 到可問答知識庫
- ✅ **智能錯誤處理**: 進度保存+自動恢復
- ✅ **效能優化**: 批次處理+並行操作
- ✅ **🎨 桌面應用**: Electron 跨平台支援
- ✅ **📝 Markdown 渲染**: 支援 LaTeX 數學公式
- ✅ **🔧 三服務設定**: Translator/Embedding/RAG 獨立配置
- ✅ **📊 即時進度**: 處理進度與日誌即時顯示

### 🚀 **技術架構更新**
- **前端框架**: Electron + Node.js 18+
- **UI 渲染**: 原生 JavaScript + Marked.js + KaTeX
- **通訊機制**: IPC (Inter-Process Communication)
- **API 層**: TypeScript 編譯模組 (API Client, Server Manager)
- **後端整合**: Flask HTTP API（完全替代 Python 腳本）

### 📦 **已棄用組件**
- ❌ **frontend/scripts/** - Python 腳本方案（已由 HTTP API 完全取代）
  - ~~chat.py~~ → `apiClient.askQuestion()`
  - ~~processor.py~~ → `apiClient.startFullProcessAsync()`
  - ~~pdfhelper_bridge.py~~ → Flask API
  - ~~pdfhelper_rag.py~~ → Flask API
  - 保留僅供歷史參考

**🏆 當前階段：完整桌面應用 100% 完成，所有核心功能已整合並可用**

## 🛠️ 技術棧實作

### 前端技術（已實作）
- **框架**: Electron 28+ (跨平台桌面應用)
- **語言**: JavaScript (ES6+) + TypeScript (API 層)
- **Markdown 渲染**: Marked.js
- **數學公式**: KaTeX
- **構建工具**: Vite (編譯 TypeScript 模組)

### 後端技術（已實作）
- **API 框架**: Flask (Python)
- **向量數據庫**: ChromaDB
- **Embedding**: Ollama (nomic-embed-v2-text-moe)
- **LLM 服務**: Gemini API + Ollama 本地模型
- **PDF 解析**: MinerU

### 部署技術
- **容器化：** Docker + Docker Compose
- **雲端部署：** Vercel (前端) + Railway/Render (後端)
- **CDN：** Cloudflare
- **監控：** Sentry + Prometheus

## 📅 時間規劃總結

| 階段 | 預估工時 | 實際工時 | 優先級 | 里程碑 | 狀態 |
|------|----------|----------|---------|---------|---------|
| 階段一 | 2-3週 | **1.5週** | HIGH | ✅ 完成基礎數據處理管道 + 翻譯系統 | **✅ DONE** |
| 階段二（前端） | 3-4週 | **5週** | HIGH | ✅ 完整 Electron 桌面應用 | **✅ DONE** |
| 階段三（RAG） | 2-3週 | **已提前完成** | MEDIUM | ✅ RAG 問答功能上線 | **✅ DONE** |
| 階段四 | 2-3週 | - | MEDIUM | 性能和體驗優化 | **規劃中** |
| 階段五 | 1-2週 | - | LOW | 生產環境部署 | **規劃中** |

**總計**: 核心功能完成度 **100%**，用時約 **6.5週**

## 🎯 近期重點工作

### **✅ 已完成 (2025-10-13)**
1. **✅ Electron 桌面應用完整開發**
   - ✅ 主程序與渲染進程架構
   - ✅ IPC 通訊機制完整實現
   - ✅ Flask 後端自動啟動與管理
   - ✅ TypeScript API Client 與 Server Manager

2. **✅ 完整 UI 界面實現**
   - ✅ Markdown 渲染與 LaTeX 支援
   - ✅ 目錄、搜尋、標註、書籤功能
   - ✅ 問答界面與聊天記錄
   - ✅ 即時進度追蹤與日誌顯示

3. **✅ HTTP API 完全整合**
   - ✅ 替換所有 Python 腳本為 HTTP API
   - ✅ 實現完整的 PDF 處理流程
   - ✅ 三服務設定系統 (Translator/Embedding/RAG)
   - ✅ 自動 collection_name 管理

4. **✅ 系統穩定性優化**
   - ✅ 錯誤處理與自動恢復
   - ✅ 卡住任務自動重置
   - ✅ 編碼問題修復 (Windows CP950)
   - ✅ 歷史記錄與狀態管理

### **🎯 下階段目標**

1. **性能優化** 🔧
   - 優化大型 PDF 處理速度
   - 改善記憶體使用效率
   - 實現更智能的快取策略

2. **用戶體驗提升** 🎨
   - 添加更多快捷鍵
   - 優化 UI 動畫與反饋
   - 改善錯誤訊息提示

3. **功能擴展** ✨
   - 實現語音輸入/輸出
   - 添加論文自動摘要
   - 支援更多文件格式

## 📝 備註

- 此TODO清單將根據開發進度和需求變更持續更新
- 建議採用敏捷開發方式，每個階段結束後進行用戶測試和反饋收集
- 可以考慮先做MVP (最小可行產品) 驗證核心功能後再擴展

---

*最後更新時間：2025年10月13日*
*項目狀態：核心功能 100% 完成，Electron 桌面應用已可使用*
*當前版本：v2.0 - 完整桌面應用 + HTTP API 整合*

